<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë°°ì†¡ ì¡°íšŒ</title>
  <link rel="stylesheet" href="../Css/home.css">
  <link rel="stylesheet" href="../Css/delivery.css"
</head>
<body>
    <div class="Navbar">
    <h1 class="logo"><a href="home.html">Shopping Mall</a></h1>
    <ul class="products">
      <li>
            <a href="./outerwear/outerwear.html">ì•„ìš°í„°</a>
            <div class="sub-category">
              <ul>
                <li><a href="./outerwear/coat.html">ì½”íŠ¸</a></li>
                <li><a href="./outerwear/jacket.html">ìì¼“</a></li>
                <li><a href="./outerwear/cardigan.html">ê°€ë””ê±´</a></li>
                <li><a href="./outerwear/vest.html">ì¡°ë¼</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./top/consultation.html">ìƒì˜</a>
            <div class="sub-category">
              <ul>
                <li><a href="./top/basic.html">ê¸°ë³¸</a></li>
                <li><a href="./top/casual.html">ìºì£¼ì–¼</a></li>
                <li><a href="./top/sweatshirt.html">ë§¨íˆ¬ë§¨</a></li>
                <li><a href="./top/hoddie.html">í›„ë“œí‹°</a></li>
                <li><a href="./top/shirt.html">ì…”ì¸ </a></li>
                <li><a href="./top/blouse.html">ë¸”ë¼ìš°ìŠ¤</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./bottom/bottom.html">í•˜ì˜</a>
            <div class="sub-category">
              <ul>
                <li><a href="./bottom/denim.html">ë°ë‹˜</a></li>
                <li><a href="./bottom/short.html">ë°˜ë°”ì§€</a></li>
                <li><a href="./bottom/cotton.html">ì½”íŠ¼</a></li>
                <li><a href="./bottom/leggings.html">ë ˆê¹…ìŠ¤</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./dress/dress.html">ì›í”¼ìŠ¤</a>
            <div class="sub-category">
              <ul>
                <li><a href="./dress/dress-min.html">ë¯¸ë‹ˆ</a></li>
                <li><a href="./dress/dress-long.html">ë¡±</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./skirt/skirt.html">ìŠ¤ì»¤íŠ¸</a>
            <div class="sub-category">
              <ul>
                <li><a href="./skirt/skirt-min.html">ë¯¸ë‹ˆ</a></li>
                <li><a href="./skirt/skirt-long.html">ë¡±</a></li>
              </ul>
            </div>
          </li>
    </ul>
    <ul class="listbar">
    </ul>
  </div>
  <div class="delivery-container">
<div class="recommended-wrapper">
  <div class="recommended-title">ì¶”ì²œ ìƒí’ˆ ì´ë¯¸ì§€(random)</div>
  <div class="recommended-box">
    <a id="recommend-link" href="#">
      <img id="recommend-image" src="" alt="ì¶”ì²œ ì´ë¯¸ì§€" />
    </a>
  </div>
</div>



    <div class="main-section">
      <aside class="side-menu">
        <ul>
          <li><a href="myInfo.html">MY ì •ë³´</a></li>
          <li><a href="cart.html">ì¥ë°”êµ¬ë‹ˆ</a></li>
          <li class="active">ë°°ì†¡ì¡°íšŒ</li>
          <li><a href="faq.html">FAQ</a></li>
          <li>
            <a href="chat.html">1:1 ë¬¸ì˜</a>
          </li>
        </ul>
      </aside>

      <section class="delivery-status-box">
        <h3>ë‚´ ì£¼ë¬¸í˜„í™©</h3>
        <div class="status-grid">
          <div>
            <div>ë°°ì†¡ì¤€ë¹„ì¤‘</div>
            <strong id="prep-count">0</strong>
          </div>
          <div>
            <div>ë°°ì†¡ì¤‘</div>
            <strong id="shipping-count">0</strong>
          </div>
          <div>
            <div>ë°°ì†¡ì™„ë£Œ</div>
            <strong id="complete-count">0</strong>
          </div>
        </div>
        <div class="status-footer" id="status-footer">
          ì·¨ì†Œ: 0 Â Â  êµí™˜: 0 Â Â  ë°˜í’ˆ: 0
        </div>
      </section>
    </div>
  </div>

<script>
  window.addEventListener("DOMContentLoaded", async () => {
    try {
      // âœ… ë¡œê·¸ì¸ í™•ì¸
      const authRes = await fetch("/api/auth/user", { credentials: "include" });
      const authData = await authRes.json();
      if (!authData.loggedIn) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        window.location.href = "/Login.html";
        return;
      }

      const userId = authData.user.userId;

      // âœ… ì£¼ë¬¸ ì •ë³´ ìš”ì²­
      const res = await fetch(`/api/orders/${userId}`, {
        credentials: "include",
        cache: "no-store"
      });
      if (!res.ok) throw new Error("ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨");

      const orders = await res.json();

      // âœ… ìƒíƒœ ì¹´ìš´í„° ì´ˆê¸°í™”
      const counts = {
        "ê²°ì œì™„ë£Œ": 0,
        "ë°°ì†¡ì¤€ë¹„ì¤‘": 0,
        "ë°°ì†¡ì¤‘": 0,
        "ë°°ì†¡ì™„ë£Œ": 0,
        "ì·¨ì†Œ": 0,
        "êµí™˜": 0,
        "ë°˜í’ˆ": 0
      };

      // âœ… ìƒíƒœ ë¼ë²¨ (í•„ìš”ì‹œ í™•ì¥ìš©)
      const statusLabel = {
        "ê²°ì œì™„ë£Œ": "ğŸ§¾ ê²°ì œ ì™„ë£Œ",
        "ë°°ì†¡ì¤€ë¹„ì¤‘": "ğŸ“¦ ë°°ì†¡ ì¤€ë¹„ ì¤‘",
        "ë°°ì†¡ì¤‘": "ğŸšš ë°°ì†¡ ì¤‘",
        "ë°°ì†¡ì™„ë£Œ": "âœ… ë°°ì†¡ ì™„ë£Œ",
        "ì·¨ì†Œ": "âŒ ì·¨ì†Œ",
        "êµí™˜": "ğŸ” êµí™˜",
        "ë°˜í’ˆ": "â†©ï¸ ë°˜í’ˆ"
      };

      orders.forEach(order => {
        const rawStatus = order.status ?? "ê²°ì œì™„ë£Œ";
        const status = rawStatus.toString().trim();

        if (counts.hasOwnProperty(status)) {
          counts[status]++;
        }
        console.log(`ğŸ“¦ ì£¼ë¬¸ ìƒíƒœ: ${statusLabel[status] || status}`);
      });

      // âœ… ìƒë‹¨ ìˆ«ì í‘œì‹œ
      document.getElementById("prep-count").textContent = counts["ë°°ì†¡ì¤€ë¹„ì¤‘"];
      document.getElementById("shipping-count").textContent = counts["ë°°ì†¡ì¤‘"];
      document.getElementById("complete-count").textContent = counts["ë°°ì†¡ì™„ë£Œ"];

      // âœ… í•˜ë‹¨ ìš”ì•½ í‘œì‹œ
      document.getElementById("status-footer").textContent =
        `ì·¨ì†Œ: ${counts["ì·¨ì†Œ"]} Â Â  êµí™˜: ${counts["êµí™˜"]} Â Â  ë°˜í’ˆ: ${counts["ë°˜í’ˆ"]}`;

    } catch (err) {
      console.error("ë°°ì†¡ í˜„í™© ë¡œë”© ì‹¤íŒ¨:", err);
    }

    // âœ… ì¶”ì²œ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ
    try {
      const res = await fetch("/api/products/random-products?count=5");
      const products = await res.json();
      if (!Array.isArray(products) || products.length === 0) return;

      const imgElement = document.getElementById("recommend-image");
      const linkElement = document.getElementById("recommend-link");
      let index = 0;

      const updateImage = () => {
        imgElement.style.opacity = 0;
        setTimeout(() => {
          const product = products[index];
          imgElement.src = product.image_url;
          imgElement.alt = product.name;
          linkElement.href = `/productDetail.html?id=${product._id}`;
          imgElement.style.opacity = 1;
          index = (index + 1) % products.length;
        }, 200);
      };

      updateImage();
      setInterval(updateImage, 3000);
    } catch (err) {
      console.error("ì¶”ì²œ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ì˜¤ë¥˜:", err);
    }
  });
</script>


</body>
</html>
