<!DOCTYPE html>
<html>
<head>
  <title>장바구니</title>
  <link href="../Css/home.css" rel="stylesheet" />
  <link href="../Css/cart.css" rel="stylesheet" />
</head>
<body>
  <div class="Navbar">
    <h1 class="logo"><a href="home.html">Shopping Mall</a></h1>
    <ul class="products">
      <li>
            <a href="./outerwear/outerwear.html">아우터</a>
            <div class="sub-category">
              <ul>
                <li><a href="./outerwear/coat.html">코트</a></li>
                <li><a href="./outerwear/jacket.html">자켓</a></li>
                <li><a href="./outerwear/cardigan.html">가디건</a></li>
                <li><a href="./outerwear/vest.html">조끼</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./top/consultation.html">상의</a>
            <div class="sub-category">
              <ul>
                <li><a href="./top/basic.html">기본</a></li>
                <li><a href="./top/casual.html">캐주얼</a></li>
                <li><a href="./top/sweatshirt.html">맨투맨</a></li>
                <li><a href="./top/hoddie.html">후드티</a></li>
                <li><a href="./top/shirt.html">셔츠</a></li>
                <li><a href="./top/blouse.html">블라우스</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./bottom/bottom.html">하의</a>
            <div class="sub-category">
              <ul>
                <li><a href="./bottom/denim.html">데님</a></li>
                <li><a href="./bottom/short.html">반바지</a></li>
                <li><a href="./bottom/cotton.html">코튼</a></li>
                <li><a href="./bottom/leggings.html">레깅스</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./dress/dress.html">원피스</a>
            <div class="sub-category">
              <ul>
                <li><a href="./dress/dress-min.html">미니</a></li>
                <li><a href="./dress/dress-long.html">롱</a></li>
              </ul>
            </div>
          </li>
          <li>
            <a href="./skirt/skirt.html">스커트</a>
            <div class="sub-category">
              <ul>
                <li><a href="./skirt/skirt-min.html">미니</a></li>
                <li><a href="./skirt/skirt-long.html">롱</a></li>
              </ul>
            </div>
          </li>
    </ul>
    <ul class="listbar">
    </ul>
  </div>

  <div class="mypage-wrapper">
    <div class="sidebar">
      <ul>
        <li><a href="myInfo.html">MY 정보</a></li>
        <li><a href="cart.html">장바구니</a></li>
        <li><a href="delivery.html">배송 조회</a></li>
        <li><a href="faq.html">FAQ</a></li>
        <li>1:1 문의</li>
      </ul>
    </div>

    <div class="cart-area">
      <h2>cart</h2>

      <!-- 비어있을 때 -->
      <table class="cart-table empty">
        <thead>
          <tr>
            <th><input type="checkbox" /></th>
            <th>이미지</th>
            <th>상품명</th>
            <th>가격</th>
            <th>수량</th>
            <th>배송구분</th>
            <th>배송비</th>
            <th>합계</th>
            <th>선택</th>
          </tr>       
        </thead>
        <tbody>
          <tr><td colspan="9" class="empty-msg">장바구니가 비어있습니다</td></tr>
        </tbody>
      </table>

      <!-- 상품이 담겼을 때 -->
      <table class="cart-table full" style="display: none;">
        <thead>
          <tr>
            <th><input type="checkbox" id="select-all"/></th>
            <th>이미지</th>
            <th>상품명</th>
            <th>가격</th>
            <th>수량</th>
            <th>배송구분</th>
            <th>배송비</th>
            <th>합계</th>
            <th>선택</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <!-- <td><input type="checkbox" /></td>
            <td><img src="test-image.jpg" alt="상품" class="item-img" /></td>
            <td>기본 트위드 자켓</td>
            <td>35,820원</td>
            <td>
              <button>-</button>
              1
              <button>+</button>
              <button>수정</button>
            </td>
            <td>무료배송</td>
            <td>0원</td>
            <td>35,820원</td>
            <td>
              <button>주문하기</button>
              <button>삭제하기</button>
            </td> -->
          </tr>
        </tbody>
      </table>

      <div class="cart-summary" style="display: none;">
        <!-- 총 구매금액: 35,820원 + 배송료: 0원 = <strong>35,820원</strong> -->
      </div>

      <div class="cart-buttons" style="display: none;">
        <button onclick="submitCheckedOrders()">주문하기</button>
        <button onclick="clearCart()">장바구니 비우기</button>
        <button><a href="./home.html">쇼핑 계속하기</a></button>
      </div>
    </div>
  </div>
  <script>
  async function submitAllOrders() {
    const userId = localStorage.getItem("userId");
    if (!userId) {
      alert("로그인이 필요합니다.");
      return;
    }

    const cart = JSON.parse(localStorage.getItem("cart")) || [];

    if (cart.length === 0) {
      alert("장바구니가 비어 있습니다.");
      return;
    }

    try {
      for (const item of cart) {
        const res = await fetch("/api/orders", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId,
            productId: item.code, // 또는 item.id 등 실제 key에 맞춰 수정
            quantity: item.quantity,
            status: "배송준비중"
          })
        });

        if (!res.ok) throw new Error("주문 실패");
      }

      alert("모든 상품이 주문되었습니다!");
      localStorage.removeItem("cart"); // 장바구니 비우기
      location.href = "delivery.html"; // 배송조회 페이지로 이동

    } catch (err) {
      console.error("주문 처리 중 오류:", err);
      alert("주문 중 오류가 발생했습니다.");
    }
  }
  </script>



  <!-- <script>
    // 실제 상황에 따라 true/false로 바뀔 값
    const hasItems = true;

    //상품이 있으면(hasItems === true) → 비어있다는 메시지 숨김, 비어있으면(hasItems === false) → 메시지 표시
    document.querySelector('.cart-table.empty').style.display = hasItems ? 'none' : '';
    //장바구니에 상품이 있으면: 전체 보여주기 (display: "" → 기본 보임), 없으면: 다 숨기기 (display: "none")
    document.querySelector('.cart-table.full').style.display = hasItems ? '' : 'none';
    document.querySelector('.cart-summary').style.display = hasItems ? '' : 'none';

    // cart-buttons는 항상 보이게 설정
    document.querySelector('.cart-buttons').style.display = '' ;
  </script> -->
  <script src="../js/navbar.js"></script>
  <script src="../js/cart.js"></script>
</body>
</html>
